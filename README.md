# Whisk

**Bidirectional sync for Paprika and Skylight grocery lists**

Whisk is a production-ready CLI tool that automatically syncs grocery lists between Paprika Recipe Manager and Skylight Calendar. Set it up once and your grocery lists stay in sync across both platforms.

## Features

üîÑ **Bidirectional Sync** - Changes in either app sync to the other automatically
üì± **Multiple Lists** - Support for syncing multiple list pairs simultaneously
‚ö° **Fast Setup** - Interactive wizard handles all configuration
üõ°Ô∏è **Conflict Resolution** - Smart handling when items change in both apps
üöÄ **Daemon Mode** - Runs in background for continuous sync
üìä **Status Monitoring** - Check sync status and daemon health

## Quick Start

### 1. Install Whisk

```bash
pip install whisk
```

### 2. Run Interactive Setup

```bash
whisk setup
```

The setup wizard will:
- Guide you through credential entry
- Discover your available lists
- Help you configure list pairs
- Set up conflict resolution preferences

### 3. Start Syncing

```bash
# One-time sync
whisk sync

# Start background daemon
whisk start

# Check status
whisk status
```

## List Pairing

Whisk supports one-to-one pairing between Paprika and Skylight lists:

```yaml
list_pairs:
  - paprika_list: "My Grocery List"
    skylight_list: "Shopping List"
    conflict_strategy: "newest_wins"

  - paprika_list: "Costco Run"
    skylight_list: "Bulk Items"
    conflict_strategy: "paprika_wins"
```

## CLI Commands

```bash
whisk setup                    # Interactive setup wizard
whisk sync                     # One-time sync of all pairs
whisk sync --list "Groceries"  # Sync specific list pair
whisk start                    # Start daemon mode
whisk stop                     # Stop daemon
whisk status                   # Show daemon status
whisk lists                    # Show configured list pairs
whisk lists paprika            # Show available Paprika lists
whisk config show              # Display current configuration
```

## Configuration

Whisk uses two configuration files:

- **`.env`** - Secure credential storage (auto-generated by setup)
- **`whisk.yaml`** - Main configuration (auto-generated by setup)

### Manual Configuration (Optional)

If you prefer manual setup, create these files:

#### `.env`
```bash
PAPRIKA_EMAIL=your-paprika-email@example.com
PAPRIKA_PASSWORD=your-paprika-password
SKYLIGHT_EMAIL=your-skylight-email@example.com
SKYLIGHT_PASSWORD=your-skylight-password
SKYLIGHT_FRAME_ID=your-frame-id
```

#### `whisk.yaml`
```yaml
sync_interval_seconds: 60
global_conflict_strategy: "newest_wins"

list_pairs:
  - paprika_list: "My Grocery List"
    skylight_list: "Shopping List"
    conflict_strategy: "newest_wins"
    enabled: true
```

## Conflict Resolution

When items change in both apps, Whisk uses these strategies:

- **`newest_wins`** - Most recently modified item wins (default)
- **`paprika_wins`** - Paprika always wins conflicts
- **`skylight_wins`** - Skylight always wins conflicts

## Daemon Mode

Run Whisk continuously in the background:

```bash
# Start daemon
whisk start

# Check if running
whisk status

# Stop daemon
whisk stop
```

The daemon automatically syncs at configured intervals and handles token refresh.

## Item Operations

Whisk syncs these operations bidirectionally:

- ‚úÖ **Add items** - New items appear in both apps
- ‚úÖ **Check/uncheck items** - Status syncs both ways
- ‚úÖ **Delete items** - Removed from both apps*
- ‚úÖ **Rename items** - Name changes sync both ways

\* *Paprika doesn't support true deletion - items are marked as "purchased" instead*

## Security

- Credentials stored in `.env` with restricted permissions (600)
- Authentication tokens cached securely
- No sensitive data logged or transmitted to third parties
- Uses official APIs with proper authentication

## Troubleshooting

### Authentication Issues
```bash
# Check credentials
whisk config check

# Re-run setup to fix credentials
whisk setup
```

### Sync Issues
```bash
# Check daemon status
whisk status

# Run one-time sync to test
whisk sync --verbose

# Check available lists
whisk lists paprika
whisk lists skylight
```

### Finding Your Skylight Frame ID
```bash
# Use the included discovery script
python -c "
from whisk.config import ConfigManager
# TODO: Add frame discovery helper
"
```

## Development

```bash
# Clone repository
git clone https://github.com/your-repo/whisk.git
cd whisk

# Install in development mode
pip install -e .

# Run tests
pytest

# Run linting
black whisk/
mypy whisk/
```

## Migration from paprika-skylight-sync

If you're upgrading from the old `paprika-skylight-sync` project:

```bash
whisk setup --migrate
```

This will automatically convert your existing configuration.

## Requirements

- Python 3.10+
- Paprika Recipe Manager account
- Skylight Calendar account with grocery lists enabled
- Internet connection for API access

## License

MIT License - see LICENSE file for details.

## Support

- Report issues: [GitHub Issues](https://github.com/your-repo/whisk/issues)
- Documentation: [GitHub Wiki](https://github.com/your-repo/whisk/wiki)
- Questions: [GitHub Discussions](https://github.com/your-repo/whisk/discussions)